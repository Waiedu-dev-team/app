# WAIEDU Project Documentation

## Phi√™n b·∫£n: 1.4.0
## Ng√†y c·∫≠p nh·∫≠t: 07/02/2025

---

## üìã T·ªïng quan d·ª± √°n

WAIEDU l√† m·ªôt h·ªá th·ªëng qu·∫£n l√Ω nh√¢n s·ª± v√† gi√°o d·ª•c ho√†n ch·ªânh bao g·ªìm:
- **Backend API** (NestJS + TypeScript) - Port 3000
- **Staff Management App** (Next.js + React + TypeScript) - Port 3001  
- **Customer Portal App** (Next.js + React + TypeScript) - Port 3002
- **Authentication System** (JWT v·ªõi role-based access)
- **Class Management System** (CRUD operations + Dashboard)
- **API Documentation** (Swagger/OpenAPI)
- **Docker Containerization** (Multi-stage builds, orchestration)
- **Production-ready Deployment** (Docker Compose, scripts, documentation)

---

## üöÄ Nh·ªØng g√¨ ƒë√£ ho√†n th√†nh

### ‚úÖ PHASE 1: Backend Foundation
**Ng√†y ho√†n th√†nh**: 07/01/2025

#### 1.1 NestJS Backend Setup
- ‚úÖ Kh·ªüi t·∫°o project NestJS v·ªõi TypeScript
- ‚úÖ C·∫•u h√¨nh Swagger API documentation
- ‚úÖ Setup CORS v√† validation pipes
- ‚úÖ C·∫•u tr√∫c project theo best practices

#### 1.2 Users Management API
- ‚úÖ **POST /users** - T·∫°o t√†i kho·∫£n ng∆∞·ªùi d√πng
  - Validation: email, password (min 6 chars), fullName, department, role
  - Enum validation cho department v√† role
  - Password hashing v·ªõi bcrypt
  - Duplicate email detection
  - Swagger documentation chi ti·∫øt v·ªõi examples

- ‚úÖ **GET /users** - L·∫•y danh s√°ch ng∆∞·ªùi d√πng
- ‚úÖ **GET /users/:id** - L·∫•y th√¥ng tin ng∆∞·ªùi d√πng theo ID

#### 1.3 Authentication System  
**Ng√†y ho√†n th√†nh**: 07/01/2025

- ‚úÖ **POST /auth/login** - API ƒëƒÉng nh·∫≠p
  - Email validation (h·ªó tr·ª£ c·∫£ email ƒë·∫ßy ƒë·ªß v√† r√∫t g·ªçn)
  - Password verification v·ªõi bcrypt
  - JWT token generation v·ªõi th√¥ng tin user
  - Token expiration: 1 hour
  - Comprehensive error handling

- ‚úÖ **JWT Strategy** - X√°c th·ª±c token
  - JWT Secret key configuration
  - Token validation middleware
  - User info extraction t·ª´ token

- ‚úÖ **Security Features**
  - Password hashing v·ªõi bcrypt (10 salt rounds)
  - JWT token v·ªõi payload: email, id, role, department
  - Protected routes v·ªõi JWT guards
  - Input validation v√† sanitization

### ‚úÖ PHASE 2: Frontend Integration
**Ng√†y ho√†n th√†nh**: 07/01/2025

#### 2.1 Authentication Frontend
- ‚úÖ **Auth Utilities** (`/lib/auth.ts`)
  - API client cho authentication
  - Token management (localStorage)
  - Token expiration handling
  - Type-safe interfaces

- ‚úÖ **Auth Context** (`/contexts/AuthContext.tsx`)
  - Global authentication state management
  - Auto-login check on app startup
  - Login/logout functions
  - User session persistence

- ‚úÖ **Protected Routes** (`/components/auth/ProtectedRoute.tsx`)
  - Route protection v·ªõi authentication check
  - Auto-redirect logic
  - Loading states
  - Support both protected v√† public routes

#### 2.2 Login Page Integration
- ‚úÖ **Updated Login Page** (`/app/login/page.tsx`)
  - Integration v·ªõi real API endpoint
  - Email auto-completion (@waiedu.com)
  - Error handling v·ªõi user-friendly messages
  - Success redirect sau khi login
  - ProtectedRoute wrapper (redirect n·∫øu ƒë√£ login)

#### 2.3 Home Page Enhancement
- ‚úÖ **Updated Home Page** (`/app/home/page.tsx`)
  - Integration v·ªõi AuthContext
  - Display real user information t·ª´ JWT
  - Proper logout functionality
  - ProtectedRoute wrapper (require authentication)

#### 2.4 App Structure
- ‚úÖ **Layout Updates** (`/app/layout.tsx`)
  - AuthProvider wrapper cho to√†n app
  - Client-side provider setup

### ‚úÖ PHASE 3: Docker Containerization & Public Sharing
**Ng√†y ho√†n th√†nh**: 07/02/2025

#### 3.1 Docker Infrastructure Setup
- ‚úÖ **Multi-stage Dockerfile** (`waiedu_backend/Dockerfile`)
  - Builder stage: Node.js 20-alpine v·ªõi full dependencies
  - Production stage: Optimized runtime v·ªõi only production dependencies
  - Non-root user (nestjs:nodejs) ƒë·ªÉ tƒÉng security
  - Health check integration
  - Static files support cho public directory

- ‚úÖ **Docker Compose Configuration** (`waiedu_backend/docker-compose.yml`)
  - Backend service v·ªõi port mapping 3000:3000
  - Network isolation v·ªõi custom bridge network
  - Environment variables configuration
  - Volume mounts cho static files
  - Health check monitoring
  - Restart policy: unless-stopped
  - Prepared PostgreSQL v√† Redis services (commented for future use)

#### 3.2 Build & Deployment Scripts
- ‚úÖ **Build Script** (`waiedu_backend/docker-build.sh`)
  - Automated Docker image building
  - Build success/failure notification
  - Image information display
  - Error handling v√† exit codes

- ‚úÖ **Run Script** (`waiedu_backend/docker-run.sh`)
  - One-command backend startup
  - Container orchestration v·ªõi docker-compose
  - Service status monitoring
  - User-friendly endpoint information
  - Logs v√† management commands guidance

#### 3.3 Docker Optimization
- ‚úÖ **Docker Ignore** (`.dockerignore`)
  - Exclude unnecessary files t·ª´ build context
  - Optimize build performance
  - Reduce image size
  - Security best practices

- ‚úÖ **Image Optimization**
  - Multi-stage build ƒë·ªÉ minimize final image size
  - Alpine Linux base image (smaller footprint)
  - Yarn cache cleaning
  - Layer caching optimization

#### 3.4 Documentation & Guides
- ‚úÖ **Comprehensive Docker Guide** (`waiedu_backend/DOCKER_README.md`)
  - Step-by-step usage instructions
  - Multiple deployment methods
  - Troubleshooting guide
  - Configuration options
  - Sharing v√† collaboration workflows
  - Cloud deployment preparation
  - Security considerations

#### 3.5 Testing & Validation
- ‚úÖ **Container Testing**
  - Successful Docker image build v·ªõi Node.js 20
  - Container startup verification
  - API endpoints accessibility (http://localhost:3000)
  - Swagger documentation availability
  - Health check functionality
  - Container logs monitoring

#### 3.6 Public Sharing Configuration (NEW!)
- ‚úÖ **0.0.0.0 Network Binding**
  - Server configured ƒë·ªÉ accept connections t·ª´ b·∫•t k·ª≥ IP n√†o
  - `main.ts` updated ƒë·ªÉ listen tr√™n `0.0.0.0:3000`
  - Docker compose binding `0.0.0.0:3000:3000`
  - Container accessible t·ª´ external networks

- ‚úÖ **Automated Scripts**
  - **setup-firewall.sh**: T·ª± ƒë·ªông m·ªü firewall ports (3000, 80, 443, 22)
  - **get-server-info.sh**: Display local IP, public IP, v√† access URLs
  - **docker-run.sh**: Enhanced v·ªõi IP detection v√† sharing instructions
  - All scripts executable v√† user-friendly

- ‚úÖ **Network Discovery & Information**
  - Automatic local IP detection (multiple methods)
  - Public IP detection (curl-based)
  - Port status checking
  - Firewall status verification
  - Complete sharing instructions

- ‚úÖ **Documentation & Guides**
  - Comprehensive sharing guide trong `DOCKER_README.md`
  - Step-by-step router configuration
  - Security best practices
  - Troubleshooting guide
  - Multiple access methods (LAN, Internet, ngrok)

### ‚úÖ PHASE 4: Class Management System & Customer Portal (NEW!)
**Ng√†y ho√†n th√†nh**: 07/02/2025

#### 4.1 Customer Management System
- ‚úÖ **Customers API Module** (`waiedu_backend/src/customers/`)
  - **POST /customers** - T·∫°o customer m·ªõi
  - **GET /customers** - L·∫•y danh s√°ch customers
  - **GET /customers/:id** - Chi ti·∫øt customer
  - **GET /customers/stats/by-field** - Th·ªëng k√™ theo lƒ©nh v·ª±c
  - **GET /customers/stats/by-location** - Th·ªëng k√™ theo ƒë·ªãa ƒëi·ªÉm
  - **GET /customers/search/by-tax-code/:taxCode** - T√¨m ki·∫øm theo m√£ s·ªë thu·∫ø

- ‚úÖ **Customer Entity & Validation**
  - BusinessField enum v·ªõi 10+ lƒ©nh v·ª±c
  - Comprehensive validation v·ªõi class-validator
  - Auto password generation cho user accounts
  - Integration v·ªõi Users module

- ‚úÖ **Auto User Account Creation**
  - Khi t·∫°o customer ‚Üí t·ª± ƒë·ªông t·∫°o user account v·ªõi role "customer"
  - Email conflict detection gi·ªØa customers v√† users
  - Default department "IT" cho customer accounts
  - Password synchronization

#### 4.2 Classes Management System  
- ‚úÖ **Classes API Module** (`waiedu_backend/src/classes/`)
  - **POST /classes** - T·∫°o l·ªõp h·ªçc m·ªõi
  - **GET /classes** - L·∫•y t·∫•t c·∫£ l·ªõp h·ªçc
  - **GET /classes/:id** - Chi ti·∫øt l·ªõp h·ªçc
  - **GET /classes/customer/:customerId** - L·ªõp h·ªçc c·ªßa customer
  - **GET /classes/user/:email/classes** - L·ªõp h·ªçc theo user email (mapping)
  - **GET /classes/customer/:customerId/stats/by-subject** - Th·ªëng k√™ theo m√¥n h·ªçc
  - **GET /classes/customer/:customerId/stats/overview** - Th·ªëng k√™ t·ªïng quan

- ‚úÖ **Class Entity & Validation**
  - Class model v·ªõi ƒë·∫ßy ƒë·ªß fields: className, subject, teacherName, teacherEmail
  - Schedule, description, maxStudents, currentStudents tracking
  - Customer relationship v√† ownership
  - Created/Updated timestamps

- ‚úÖ **Advanced Features**
  - Conflict detection: T√™n l·ªõp unique per customer
  - Statistics generation: Classes, teachers, students counts
  - Subject-based analytics
  - User email to customer ID mapping

#### 4.3 Customer Portal Application (NEW!)
- ‚úÖ **Project Setup** (`client_staff/` - Port 3002)
  - Next.js 15.3.4 v·ªõi App Router
  - TypeScript configuration
  - Tailwind CSS v·ªõi modern design system
  - Clean project structure (68% file reduction t·ª´ original)

- ‚úÖ **Authentication Integration**
  - Customer login v·ªõi role validation ("customer" only)
  - JWT token management trong localStorage
  - Auto-append @waiedu.com domain
  - Protected routes v·ªõi role checking
  - Auto-redirect logic

- ‚úÖ **Dashboard Features**
  - Real-time user information display
  - Statistics overview (classes, teachers, students)
  - Class creation functionality
  - Modern gradient UI v·ªõi hover effects
  - Responsive design

- ‚úÖ **Class Creation System**
  - Form validation v·ªõi comprehensive field validation
  - Subject dropdown v·ªõi 13+ m√¥n h·ªçc ph·ªï bi·∫øn
  - Teacher information management
  - Schedule v√† description fields
  - Max students configuration
  - API integration v·ªõi error handling

#### 4.4 Multi-App Architecture (NEW!)
- ‚úÖ **Three-App Ecosystem**
  - **Backend API** (Port 3000): NestJS v·ªõi comprehensive APIs
  - **Staff App** (Port 3001): Staff management, customer creation
  - **Customer Portal** (Port 3002): Customer login, class management

- ‚úÖ **Role-Based Access Control**
  - Staff users: Access to staff app, customer management
  - Customer users: Access to customer portal only
  - JWT payload includes role information
  - Route-level role validation

- ‚úÖ **Cross-App Integration**
  - Staff t·∫°o customer ‚Üí Auto user account creation
  - Customer login v√†o portal ‚Üí Class management capabilities
  - Shared backend APIs v·ªõi role-based endpoints
  - Consistent authentication flow

---

## üèóÔ∏è Ki·∫øn tr√∫c h·ªá th·ªëng (Updated)

### Backend Architecture
```
waiedu_backend/ (Port 3000)
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ auth/                    # Authentication module
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/                 # Data Transfer Objects
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login.dto.ts     # Login request validation
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ login-response.dto.ts # Login response format
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ strategies/          # Passport strategies
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ jwt.strategy.ts  # JWT authentication strategy
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guards/              # Route guards
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ jwt-auth.guard.ts # JWT protection guard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts   # Auth endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts      # Auth business logic
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.module.ts       # Auth module configuration
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ users/                   # Users management module
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/                 # Data Transfer Objects
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ create-user.dto.ts # User creation validation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/            # Database entities
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.entity.ts   # User data model
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.controller.ts  # User endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.service.ts     # User business logic
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users.module.ts      # Users module configuration
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ customers/               # Customer management module (NEW!)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/                 
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ create-customer.dto.ts # Customer validation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/            
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ customer.entity.ts # Customer model v·ªõi BusinessField enum
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ customers.controller.ts # Customer endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ customers.service.ts # Business logic + User integration
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ customers.module.ts  # Module configuration
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ classes/                 # Class management module (NEW!)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/                 
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ create-class.dto.ts # Class validation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/            
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ class.entity.ts  # Class model v·ªõi schedule, teacher info
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ classes.controller.ts # Class endpoints + Statistics
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ classes.service.ts   # Business logic + Customer integration
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ classes.module.ts    # Module configuration
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ tasks/                   # Task management module
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ task.entity.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tasks.module.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ app.module.ts           # Main application module
‚îÇ   ‚îî‚îÄ‚îÄ main.ts                 # Application entry point + Swagger setup
‚îÇ
‚îú‚îÄ‚îÄ public/                     # Static files
‚îÇ   ‚îî‚îÄ‚îÄ index.html              # API testing interface
‚îÇ
‚îú‚îÄ‚îÄ Dockerfile                  # Multi-stage Docker build configuration
‚îú‚îÄ‚îÄ docker-compose.yml          # Container orchestration v·ªõi services
‚îú‚îÄ‚îÄ .dockerignore              # Docker build optimization
‚îú‚îÄ‚îÄ docker-build.sh            # Automated build script
‚îú‚îÄ‚îÄ docker-run.sh              # One-command deployment script
‚îú‚îÄ‚îÄ setup-firewall.sh          # Firewall configuration script (NEW!)
‚îú‚îÄ‚îÄ get-server-info.sh         # Server information script (NEW!)
‚îî‚îÄ‚îÄ DOCKER_README.md           # Comprehensive Docker documentation
```

### Staff Management App Architecture
```
waiedu_staff/ (Port 3001)
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/                    # Next.js App Router
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/              # Login page
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ home/               # Dashboard page (protected)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ customers/          # Customer management (NEW!)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ create/         # Customer creation form
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layout.tsx          # Root layout v·ªõi AuthProvider
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ components/             # Reusable components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/               # Authentication components
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProtectedRoute.tsx # Route protection component
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ providers/          # Context providers
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ClientProviders.tsx # Client-side providers wrapper
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ contexts/               # React contexts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthContext.tsx     # Authentication state management
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ lib/                    # Utilities
‚îÇ       ‚îî‚îÄ‚îÄ auth.ts             # Authentication utilities & API client
```

### Customer Portal App Architecture (NEW!)
```
client_staff/ (Port 3002)
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/                    # Next.js App Router
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx            # Customer login page
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/          # Customer dashboard (protected)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx        # Dashboard v·ªõi stats v√† class list
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ classes/            # Class management
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ create/         # Class creation form
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx    # Form v·ªõi validation v√† API integration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx          # Root layout
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ globals.css         # Global styles
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ components/             # Reusable UI components
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui/                 # Base UI components
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ button.tsx      # Button component
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ card.tsx        # Card component
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ input.tsx       # Input component
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ label.tsx       # Label component
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ lib/                    # Utilities
‚îÇ       ‚îî‚îÄ‚îÄ utils.ts            # Utility functions
```

---

## üåê Complete Workflow Guide (NEW!)

### üéØ End-to-End User Journey

#### 1. Staff Creates Customer Account
**App**: Staff Management App (Port 3001)
**URL**: `http://localhost:3001/customers/create`

1. Staff login v·ªõi staff credentials
2. Navigate to Customer Creation form
3. Fill customer information:
   - Email, Full Name, Tax Code
   - Business Field (education, technology, etc.)
   - Location (city, district)
   - Default password for customer
4. Submit ‚Üí **Automatically creates**:
   - Customer record trong database
   - User account v·ªõi role "customer"
   - Password synchronization

#### 2. Customer Logs Into Portal
**App**: Customer Portal (Port 3002)
**URL**: `http://localhost:3002`

1. Customer enters email (auto-appends @waiedu.com)
2. Enters password (set by staff)
3. System validates:
   - User existence v√† password
   - Role verification (must be "customer")
   - JWT token generation
4. Redirect to dashboard

#### 3. Customer Uses Class Management
**App**: Customer Portal Dashboard
**URL**: `http://localhost:3002/dashboard`

**Dashboard Features**:
- User information display
- Real-time statistics (classes, teachers, students)
- Quick action buttons
- Recent classes overview

**Class Creation Flow**:
1. Click "T·∫°o l·ªõp h·ªçc" button
2. Fill comprehensive form:
   - Class name, subject (dropdown)
   - Teacher name v√† email
   - Schedule, description
   - Max students limit
3. Form validation v√† API submission
4. Success feedback v√† dashboard update

### üîÑ Data Flow Architecture

```
Staff App (3001) ‚Üí Backend API (3000) ‚Üí Customer Portal (3002)
     ‚Üì                    ‚Üì                        ‚Üì
Customer Creation    Auto User Account      Customer Login
     ‚Üì                    ‚Üì                        ‚Üì
Database Storage    JWT Generation         Class Management
```

---

## üîß API Endpoints (Updated)

### Authentication
- **POST** `/auth/login` - ƒêƒÉng nh·∫≠p ng∆∞·ªùi d√πng (staff + customer)
  - Body: `{ email: string, password: string }`
  - Response: `{ access_token: string, user: User, expires_in: number, token_type: string }`
  - Status: 200 (Success) / 401 (Unauthorized) / 400 (Bad Request)

### Users Management
- **POST** `/users` - T·∫°o t√†i kho·∫£n m·ªõi
- **GET** `/users` - L·∫•y danh s√°ch ng∆∞·ªùi d√πng
- **GET** `/users/:id` - L·∫•y th√¥ng tin ng∆∞·ªùi d√πng theo ID

### Customers Management (NEW!)
- **POST** `/customers` - T·∫°o customer m·ªõi (auto-creates user account)
- **GET** `/customers` - L·∫•y danh s√°ch customers
- **GET** `/customers/:id` - Chi ti·∫øt customer
- **GET** `/customers/stats/by-field` - Th·ªëng k√™ theo lƒ©nh v·ª±c kinh doanh
- **GET** `/customers/stats/by-location` - Th·ªëng k√™ theo ƒë·ªãa ƒëi·ªÉm
- **GET** `/customers/search/by-tax-code/:taxCode` - T√¨m ki·∫øm theo m√£ s·ªë thu·∫ø

### Classes Management (NEW!)
- **POST** `/classes` - T·∫°o l·ªõp h·ªçc m·ªõi
- **GET** `/classes` - L·∫•y t·∫•t c·∫£ l·ªõp h·ªçc
- **GET** `/classes/:id` - Chi ti·∫øt l·ªõp h·ªçc
- **GET** `/classes/customer/:customerId` - L·ªõp h·ªçc c·ªßa customer c·ª• th·ªÉ
- **GET** `/classes/user/:email/classes` - L·ªõp h·ªçc theo user email (customer portal)
- **GET** `/classes/customer/:customerId/stats/by-subject` - Th·ªëng k√™ theo m√¥n h·ªçc
- **GET** `/classes/customer/:customerId/stats/overview` - Th·ªëng k√™ t·ªïng quan

### API Documentation
- **GET** `/api-docs` - Swagger UI interface
- Comprehensive API documentation v·ªõi examples v√† error responses

---

## üß™ Testing Guide (Updated)

### Quick Test Workflow

#### 1. Setup Environment
```bash
# Start backend
cd waiedu_backend
./docker-run.sh

# Backend running on http://localhost:3000
# API docs: http://localhost:3000/api-docs
```

#### 2. Test Customer Creation (Staff App)
```bash
# Start staff app
cd waiedu_staff
PORT=3001 npm run dev

# Navigate to: http://localhost:3001/customers/create
# Create test customer with:
# - Email: test@waiedu.com
# - Full Name: Nguy·ªÖn VƒÉn Test  
# - Default Password: 123456
# - Field: education
# - Tax Code: TEST001
# - City: hanoi, District: hoankiem
```

#### 3. Test Customer Login (Customer Portal)
```bash
# Start customer portal
cd client_staff
PORT=3002 npm run dev

# Navigate to: http://localhost:3002
# Login with:
# - Email: test (auto-appends @waiedu.com)
# - Password: 123456
# 
# Should redirect to dashboard v·ªõi user info
```

#### 4. Test Class Creation
```bash
# In customer portal dashboard
# Click "T·∫°o l·ªõp h·ªçc"
# Fill form v·ªõi:
# - Class Name: L·ªõp To√°n N√¢ng Cao
# - Subject: To√°n h·ªçc (dropdown)
# - Teacher Name: Nguy·ªÖn VƒÉn Gi√°o  
# - Teacher Email: teacher@example.com
# - Schedule: Th·ª© 2,4,6 - 7:00-9:00
# - Max Students: 30
# - Description: L·ªõp h·ªçc to√°n n√¢ng cao cho h·ªçc sinh gi·ªèi
#
# Submit ‚Üí Success message ‚Üí Dashboard updates v·ªõi new class
```

### API Testing v·ªõi cURL

#### Test Customer Creation
```bash
curl -X POST http://localhost:3000/customers \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@waiedu.com",
    "fullName": "Nguy·ªÖn VƒÉn Test",
    "defaultPassword": "123456",
    "field": "education",
    "taxCode": "TEST001",
    "city": "hanoi",
    "district": "hoankiem"
  }'
```

#### Test Customer Login
```bash
curl -X POST http://localhost:3000/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@waiedu.com",
    "password": "123456"
  }'
```

#### Test Class Creation (v·ªõi JWT token)
```bash
curl -X POST http://localhost:3000/classes \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "className": "L·ªõp To√°n N√¢ng Cao",
    "subject": "To√°n h·ªçc",
    "teacherName": "Nguy·ªÖn VƒÉn Gi√°o",
    "teacherEmail": "teacher@example.com",
    "description": "L·ªõp h·ªçc to√°n n√¢ng cao",
    "schedule": "Th·ª© 2,4,6 - 7:00-9:00",
    "maxStudents": 30,
    "customerId": "CUSTOMER_ID_FROM_CREATION_RESPONSE"
  }'
```

### Manual Testing Completed
- ‚úÖ Customer creation v·ªõi auto user account generation
- ‚úÖ Customer login v·ªõi role validation
- ‚úÖ JWT token generation cho customer users
- ‚úÖ Protected customer portal access
- ‚úÖ Class creation v·ªõi form validation
- ‚úÖ API integration gi·ªØa frontend v√† backend
- ‚úÖ Real-time dashboard updates
- ‚úÖ Cross-app workflow (staff ‚Üí customer)

---

## üéØ User Roles & Permissions (NEW!)

### Staff Users
**Access**: Staff Management App (Port 3001)
**Permissions**:
- Create/manage customer accounts
- View customer statistics
- Access all backend APIs
- User management functionality

### Customer Users  
**Access**: Customer Portal (Port 3002)
**Permissions**:
- Login to customer portal only
- Create v√† manage own classes
- View own dashboard v√† statistics
- Limited API access (own data only)

### Role Validation Flow
1. **Login Request** ‚Üí JWT payload includes role
2. **Frontend Check** ‚Üí Route protection based on role
3. **Backend Validation** ‚Üí API endpoints validate user role
4. **Access Control** ‚Üí Allow/deny based on role permissions

---

## üöÄ Deployment Ready (Updated)

### Environment Variables
```bash
# Backend (.env)
PORT=3000
HOST=0.0.0.0
NODE_ENV=development
JWT_SECRET=waiedu-secret-key-2024
CORS_ORIGIN=*
```

### Multi-App Development Setup
```bash
# Terminal 1: Start Backend
cd waiedu_backend
./docker-run.sh
# Backend running on http://localhost:3000

# Terminal 2: Start Staff App  
cd waiedu_staff
PORT=3001 npm run dev
# Staff app on http://localhost:3001

# Terminal 3: Start Customer Portal
cd client_staff  
PORT=3002 npm run dev
# Customer portal on http://localhost:3002
```

### Production Deployment Commands
```bash
# All-in-one development start
./start-dev.sh          # Starts all 3 services

# Individual service control
./start-backend.sh      # Backend only
./start-frontend.sh     # Frontend apps only
./stop-dev.sh          # Stop all services
./status.sh            # Check service status
```

### üê≥ Docker Deployment (Recommended)

#### Quick Start
```bash
# Navigate to backend directory
cd waiedu_backend

# Build v√† run v·ªõi m·ªôt l·ªánh
./docker-run.sh

# Ho·∫∑c manual commands
./docker-build.sh      # Build Docker image
sudo docker-compose up -d  # Start services
```

#### üåê Public Sharing Setup
```bash
# Step 1: Setup firewall
./setup-firewall.sh

# Step 2: Start server (configured for 0.0.0.0)
./docker-run.sh

# Step 3: Get server access information
./get-server-info.sh
```

#### Docker Endpoints
- **Backend API**: http://localhost:3000
- **API Documentation**: http://localhost:3000/api-docs
- **Network Access**: http://YOUR_LOCAL_IP:3000 
- **Public Access**: http://YOUR_PUBLIC_IP:3000 (with port forwarding)

#### Production Deployment
```bash
# Build production images
docker build -t waiedu-backend:v1.4.0 .

# Export cho team sharing
docker save waiedu-backend:latest | gzip > waiedu-backend.tar.gz

# Deploy l√™n cloud registry
docker tag waiedu-backend:latest your-registry/waiedu-backend:latest
docker push your-registry/waiedu-backend:latest
```

---

## üåê Server Sharing Guide

### üöÄ Quick Sharing Steps

#### 1. Chu·∫©n b·ªã server ƒë·ªÉ share
```bash
cd waiedu_backend
./setup-firewall.sh    # M·ªü firewall ports
./docker-run.sh         # Start server v·ªõi 0.0.0.0 binding
```

#### 2. L·∫•y th√¥ng tin truy c·∫≠p
```bash
./get-server-info.sh    # Hi·ªÉn th·ªã t·∫•t c·∫£ th√¥ng tin c·∫ßn thi·∫øt
```

### üì± C√°c c√°ch truy c·∫≠p

#### üè† Trong m·∫°ng local (WiFi/LAN)
- **Backend API**: `http://YOUR_LOCAL_IP:3000`
- **Staff App**: `http://YOUR_LOCAL_IP:3001` (if deployed)
- **Customer Portal**: `http://YOUR_LOCAL_IP:3002` (if deployed)
- **Ai c√≥ th·ªÉ truy c·∫≠p**: M·ªçi ng∆∞·ªùi trong c√πng WiFi/m·∫°ng
- **Setup**: Kh√¥ng c·∫ßn config g√¨ th√™m

#### üåç T·ª´ Internet (Public Access)
- **Backend API**: `http://YOUR_PUBLIC_IP:3000`
- **Ai c√≥ th·ªÉ truy c·∫≠p**: B·∫•t k·ª≥ ai c√≥ link
- **Setup required**: 
  1. Port forwarding tr√™n router: `3000 ‚Üí YOUR_LOCAL_IP:3000`
  2. Ki·ªÉm tra ISP kh√¥ng block port 3000

#### üîó S·ª≠ d·ª•ng ngrok (D·ªÖ nh·∫•t)
```bash
# Install ngrok
wget https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.zip
unzip ngrok-stable-linux-amd64.zip && sudo mv ngrok /usr/local/bin/

# Start tunnel
ngrok http 3000
```
- **URL**: `https://abc123.ngrok.io` (auto-generated)
- **∆Øu ƒëi·ªÉm**: HTTPS mi·ªÖn ph√≠, kh√¥ng c·∫ßn config router
- **Nh∆∞·ª£c ƒëi·ªÉm**: URL thay ƒë·ªïi m·ªói l·∫ßn restart

### üîí Security Checklist

#### Tr∆∞·ªõc khi share public:
- [ ] ƒê·ªïi `JWT_SECRET` trong environment variables
- [ ] Ki·ªÉm tra firewall ƒë√£ m·ªü port 3000: `sudo ufw status`
- [ ] Test truy c·∫≠p t·ª´ m√°y kh√°c trong m·∫°ng
- [ ] ƒê·∫£m b·∫£o c√≥ authentication m·∫°nh
- [ ] Monitor logs ƒë·ªÉ ph√°t hi·ªán truy c·∫≠p b·∫•t th∆∞·ªùng

#### Environment Variables (.env):
```env
PORT=3000
HOST=0.0.0.0
NODE_ENV=production
JWT_SECRET=your-very-secure-secret-key-here
CORS_ORIGIN=*
```

### üìä Ki·ªÉm tra tr·∫°ng th√°i

#### Server status:
```bash
sudo docker-compose ps              # Container status
ss -tlnp | grep :3000              # Port listening check
curl http://localhost:3000          # Local connectivity test
```

#### Network connectivity:
```bash
curl http://YOUR_LOCAL_IP:3000      # LAN connectivity test
curl http://YOUR_PUBLIC_IP:3000     # Public connectivity test
```

---

## üîê Security Implementation (Updated)

### Password Security
- Bcrypt hashing v·ªõi 10 salt rounds
- Minimum password length: 6 characters
- Password kh√¥ng ƒë∆∞·ª£c tr·∫£ v·ªÅ trong API responses
- Auto-generated passwords cho customer accounts

### JWT Security
- HS256 algorithm
- 1 hour expiration time
- Payload includes: email, user ID, role, department
- Secret key configurable via environment variables
- Role-based payload validation

### Input Validation
- Class-validator decorators cho t·∫•t c·∫£ DTOs
- Email format validation
- Required field validation
- Enum validation cho department, role, business fields
- Request payload sanitization
- XSS protection trong form inputs

### Access Control
- Role-based route protection
- Customer users: Limited to own data access
- Staff users: Full administrative access
- JWT guards tr√™n sensitive endpoints
- Frontend route protection based on user role

---

## üìù Next Steps (Updated)

### PHASE 5: Database Integration (High Priority)
- [ ] PostgreSQL setup v·ªõi Docker (uncomment trong docker-compose.yml)
- [ ] Database migrations v√† schema cho all entities
- [ ] Replace in-memory storage v·ªõi real database persistence
- [ ] Relationship mapping gi·ªØa Users, Customers, v√† Classes
- [ ] Data backup v√† recovery procedures

### PHASE 6: Advanced Class Features
- [ ] Student enrollment system
- [ ] Teacher management module  
- [ ] Class scheduling v·ªõi calendar integration
- [ ] Attendance tracking system
- [ ] Grade management
- [ ] Parent portal integration

### PHASE 7: Enhanced UI/UX
- [ ] Advanced dashboard v·ªõi charts v√† analytics
- [ ] Real-time notifications system
- [ ] Mobile-responsive optimizations
- [ ] Dark mode theme support
- [ ] Advanced filtering v√† search capabilities
- [ ] Bulk operations cho class management

### PHASE 8: Production Enhancements  
- [ ] Redis caching layer (prepared trong docker-compose.yml)
- [ ] API rate limiting v√† request throttling
- [ ] Security headers middleware
- [ ] Application monitoring v√† logging (Winston, PM2)
- [ ] Health check endpoints expansion
- [ ] Backup v√† disaster recovery procedures

### PHASE 9: Advanced Security
- [ ] Two-factor authentication (2FA) 
- [ ] OAuth integration (Google, Microsoft)
- [ ] SSL/TLS certificates setup
- [ ] Security scanning v√† vulnerability assessment
- [ ] GDPR compliance features
- [ ] Audit logging cho all user actions

---

## üìû Support & Maintenance

### Created by: AI Assistant
### Last updated: 07/02/2025 - 16:05 ICT
### Version: 1.4.0

**Major Updates trong v1.4.0**:
- ‚úÖ Complete Class Management System implementation
- ‚úÖ Customer Portal application (client_staff)
- ‚úÖ Multi-app architecture v·ªõi role-based access
- ‚úÖ Customer authentication integration
- ‚úÖ Advanced API endpoints v·ªõi statistics
- ‚úÖ Comprehensive testing workflows
- ‚úÖ Updated documentation v·ªõi complete user journeys

**L∆∞u √Ω**: M·ªçi thay ƒë·ªïi quan tr·ªçng s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t v√†o file docs.md n√†y ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh li√™n t·ª•c v√† d·ªÖ maintenance cho team ph√°t tri·ªÉn.

---

## üé® UI/UX Excellence (Updated)

D·ª± √°n ƒë∆∞·ª£c thi·∫øt k·∫ø theo tri·∫øt l√Ω **Steve Jobs** v·ªõi s·ª± ch√∫ tr·ªçng ƒë·∫∑c bi·ªát v√†o:

### Design Philosophy
- **T·ªëi gi·∫£n v√† Trung th·ª±c**: UI clean, kh√¥ng cluttered across all 3 applications
- **Thao t√°c tr·ª±c ti·∫øp**: Intuitive interactions trong customer portal
- **Ph·∫£n h·ªìi t·ª©c th√¨**: Immediate feedback cho user actions (form submission, validation)
- **Chuy·ªÉn ƒë·ªông c√≥ √Ω nghƒ©a**: Smooth transitions guide user flow between apps

### Attention to Details
- **Perfect Typography**: Font hierarchy v√† spacing consistency
- **Color Harmony**: Gradient designs v·ªõi blue-indigo-purple palette
- **Micro-interactions**: Hover effects, loading states, form validation
- **Responsive Design**: Works perfectly on all screen sizes
- **Accessibility**: Proper contrast ratios, keyboard navigation, screen reader support

### Customer Portal UX Excellence (NEW!)
- **Dashboard Experience**: Information-rich yet clean layout
- **Form Design**: Multi-step validation v·ªõi real-time feedback
- **Statistics Display**: Visual cards v·ªõi meaningful icons
- **Class Management**: Intuitive creation flow v·ªõi comprehensive validation
- **Error Handling**: User-friendly error messages with actionable guidance

### Multi-App Consistency
1. **Consistent Design Language**: Shared color schemes, typography, spacing
2. **Unified Authentication Flow**: Seamless login experience across apps
3. **Responsive Navigation**: Intuitive routing v√† state management
4. **Cross-App Integration**: Smooth workflow t·ª´ staff app ‚Üí customer portal

M·ªói component ƒë∆∞·ª£c thi·∫øt k·∫ø v·ªõi s·ª± c·∫ßu to√†n nh∆∞ **Apple products** - t·ª´ spacing, colors, animations ƒë·∫øn interaction patterns ƒë·ªÅu ƒë∆∞·ª£c t·ªëi ∆∞u ƒë·ªÉ t·∫°o ra tr·∫£i nghi·ªám ng∆∞·ªùi d√πng tuy·ªát v·ªùi nh·∫•t trong c·∫£ 3 applications.
